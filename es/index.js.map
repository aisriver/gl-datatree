{"version":3,"sources":["index.js"],"names":["THREE","OrbitControls","getDomInfo","updateTooltip","clearTooltip","toWindowPosition","RAF","createDataTree","groundImg","require","GlDataTree","renderer","camera","scene","pointLight","ambLight","controls","treeGroup","selectedNode","dom","rayRaster","Raycaster","mouse","Vector2","mouseInfo","autoPlay","playInterval","autoRotate","treeData","treeTitle","listening","handleMousemove","e","x","y","width","height","correctX","clientX","correctY","clientY","animate","bind","setOption","dispose","props","shadow","WebGLRenderer","antialias","setSize","shadowMapEnabled","appendChild","domElement","setClearColor","PerspectiveCamera","position","set","lookAt","target","Vector3","update","fog","Scene","background","Color","Fog","loader","TextureLoader","groundTexture","load","wrapS","wrapT","RepeatWrapping","repeat","anisotropy","groundMaterial","MeshLambertMaterial","map","mesh","Mesh","PlaneBufferGeometry","rotation","Math","PI","receiveShadow","add","PointLight","castShadow","near","far","mapSize","AmbientLight","object","currentMesh","domPosition","userData","type","document","body","style","cursor","transparent","opacity","color","onSelected","requestAnimationFrame","setFromCamera","intersects","intersectObjects","children","length","uuid","resetNodeStyle","showDetails","z","render","time","ids","raf","index","setInterval","preMesh","getObjectByName","obj","domInfo","title","data","JSON","stringify","group","loopDetail","box","Box3","setFromObject","max","isNaN","cleanMaterial","material","Object","keys","key","value","traverse","geometry","materials","Array","isArray","forEach","glDom","initRenderer","initCamera","initScene","initLight","clear","onmousemove"],"mappings":"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","sourcesContent":["import * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport { getDomInfo } from './utils/dom';\nimport { updateTooltip, clearTooltip } from './utils/tooltip';\nimport { toWindowPosition } from './utils/position';\nimport RAF from './utils/RAF';\nimport createDataTree from './utils/datatree';\nconst groundImg = require('./assets/grasslight-small.jpg');\nclass GlDataTree {\n    constructor() {\n        this.renderer = null;\n        this.camera = null;\n        this.scene = null;\n        this.pointLight = null;\n        this.ambLight = null;\n        this.controls = null;\n        this.treeGroup = null;\n        this.selectedNode = null;\n        this.dom = null;\n        this.rayRaster = new THREE.Raycaster();\n        this.mouse = new THREE.Vector2();\n        this.mouseInfo = null;\n        // 是否开启自动播放\n        this.autoPlay = false;\n        // autoPlay interval\n        this.playInterval = 3000;\n        // 场景自动旋转\n        this.autoRotate = false;\n        this.treeData = [];\n        this.treeTitle = '';\n        this.listening = {};\n        /**\n         * 鼠标移动\n         */\n        this.handleMousemove = (e, dom) => {\n            this.mouseInfo = e;\n            const { x, y, width, height } = getDomInfo(dom);\n            // 标准设备横坐标\n            const correctX = ((e.clientX - x) / width) * 2 - 1;\n            // 标准设备纵坐标\n            const correctY = -((e.clientY - y) / height) * 2 + 1;\n            this.mouse.x = correctX;\n            this.mouse.y = correctY;\n        };\n        this.animate = this.animate.bind(this);\n        this.setOption = this.setOption.bind(this);\n        this.dispose = this.dispose.bind(this);\n    }\n    /**\n     * 初始化renderer\n     * @param props\n     */\n    initRenderer(props) {\n        const { shadow = true } = props || {};\n        if (this.dom) {\n            const { width, height } = getDomInfo(this.dom);\n            this.renderer = new THREE.WebGLRenderer({ antialias: true });\n            this.renderer.setSize(width, height);\n            this.renderer.shadowMapEnabled = shadow;\n            this.dom.appendChild(this.renderer.domElement);\n            this.renderer.setClearColor(0xffffff, 1.0);\n        }\n    }\n    /**\n     * 初始化camera\n     * @param param0\n     */\n    initCamera() {\n        if (this.dom && this.renderer) {\n            const { width, height } = getDomInfo(this.dom);\n            this.camera = new THREE.PerspectiveCamera(45, width / height, 1, 1000);\n            this.camera.position.set(0, 8, 60);\n            this.camera.lookAt(0, 0, 0);\n            // stats = new Stats();\n            // dom.appendChild(stats.dom);\n            this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n            this.controls.target = new THREE.Vector3(0, 0, 0);\n            this.controls.update();\n            this.dom.appendChild(this.renderer.domElement);\n        }\n    }\n    /**\n     *初始化scene\n     * @param props\n     */\n    initScene(props) {\n        const { fog = true } = props || {};\n        this.scene = new THREE.Scene();\n        this.scene.background = new THREE.Color(0xcce0ff);\n        if (fog) {\n            this.scene.fog = new THREE.Fog(0xcce0ff, 50, 500);\n        }\n        // ground\n        const loader = new THREE.TextureLoader();\n        const groundTexture = loader.load(groundImg);\n        groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;\n        groundTexture.repeat.set(25, 25);\n        groundTexture.anisotropy = 16;\n        const groundMaterial = new THREE.MeshLambertMaterial({ map: groundTexture });\n        const mesh = new THREE.Mesh(new THREE.PlaneBufferGeometry(1000, 1000), groundMaterial);\n        mesh.rotation.x = -Math.PI / 2;\n        mesh.receiveShadow = true;\n        this.scene.add(mesh);\n    }\n    /**\n     * 初始化灯光\n     */\n    initLight() {\n        if (this.scene) {\n            // 点光\n            this.pointLight = new THREE.PointLight(0xffffff, 1.0, 0);\n            this.pointLight.position.set(100, 100, 200);\n            this.pointLight.castShadow = true;\n            this.pointLight.shadow.camera.near = 8;\n            this.pointLight.shadow.camera.far = 1000;\n            this.pointLight.shadow.mapSize.width = 1024;\n            this.pointLight.shadow.mapSize.height = 1024;\n            // 环境光\n            this.ambLight = new THREE.AmbientLight(0x666666);\n            this.scene.add(this.ambLight);\n            this.scene.add(this.pointLight);\n        }\n    }\n    /**\n     * 重置选择对象的样式\n     */\n    resetNodeStyle() {\n        if (!this.selectedNode) {\n            return;\n        }\n        this.selectedNode.object['material']['opacity'] = 1;\n        this.selectedNode.object['material']['color'].set(0xffffff);\n    }\n    /**\n     * 详情展示\n     * @param currentMesh\n     * @param domPosition\n     */\n    showDetails(currentMesh, domPosition) {\n        if (currentMesh) {\n            const { userData } = currentMesh;\n            if (!userData.type) {\n                return;\n            }\n            document.body.style.cursor = 'pointer';\n            currentMesh['material'].transparent = true;\n            currentMesh['material'].opacity = 0.6;\n            currentMesh['material'].color.set(0xff0000);\n            const { onSelected } = this.listening;\n            if (onSelected) {\n                onSelected(userData, domPosition);\n            }\n        }\n    }\n    /**\n     * 动画\n     */\n    animate() {\n        requestAnimationFrame(this.animate);\n        if (this.controls) {\n            this.controls.update();\n        }\n        if (this.camera) {\n            //射线射出\n            this.rayRaster.setFromCamera(this.mouse, this.camera);\n            //射线上的物体\n            if (this.treeGroup) {\n                const intersects = this.rayRaster.intersectObjects(this.treeGroup.children);\n                if (intersects.length > 0 && this.mouseInfo) {\n                    if (this.selectedNode && this.selectedNode.object.uuid !== intersects[0].object.uuid) {\n                        this.resetNodeStyle();\n                    }\n                    this.selectedNode = intersects[0];\n                    this.showDetails(this.selectedNode.object, { x: this.mouseInfo.clientX, y: this.mouseInfo.clientY });\n                }\n                else {\n                    document.body.style.cursor = 'auto';\n                    if (!this.autoPlay) {\n                        clearTooltip();\n                    }\n                    this.resetNodeStyle();\n                }\n            }\n        }\n        if (this.renderer && this.pointLight && this.camera && this.scene) {\n            // 根据相机位置调整光源\n            this.pointLight.position.set(this.camera.position.x * 2 + 50, this.camera.position.y * 2, this.camera.position.z * 2);\n            this.renderer.render(this.scene, this.camera);\n        }\n        // stats.update();\n    }\n    /**\n     * 自动播放详情\n     */\n    loopDetail(time = this.playInterval) {\n        if (!this.treeGroup ||\n            !this.treeGroup.userData ||\n            !this.treeGroup.userData.ids ||\n            !this.scene ||\n            !this.camera ||\n            !this.dom) {\n            return;\n        }\n        const scene = this.scene;\n        const camera = this.camera;\n        const dom = this.dom;\n        const ids = this.treeGroup.userData.ids || [];\n        const length = ids.length;\n        const raf = new RAF();\n        if (length > 0) {\n            let index = -1;\n            raf.setInterval(() => {\n                // 先重置\n                if (index !== -1) {\n                    const preMesh = scene.getObjectByName(ids[index]);\n                    if (preMesh) {\n                        preMesh['material'].opacity = 1;\n                        preMesh['material']['color'].set(0xffffff);\n                    }\n                }\n                if (index < length - 1) {\n                    index++;\n                }\n                else {\n                    index = 0;\n                }\n                const currentMesh = scene.getObjectByName(ids[index]);\n                if (currentMesh && currentMesh.userData) {\n                    const { userData } = currentMesh;\n                    const domPosition = toWindowPosition({\n                        obj: currentMesh,\n                        camera,\n                        domInfo: getDomInfo(dom),\n                    });\n                    if (userData.type) {\n                        this.showDetails(currentMesh, { ...domPosition, x: domPosition.x + 100 });\n                    }\n                }\n            }, time);\n        }\n    }\n    /**\n     * 设置数据配置\n     */\n    setOption(props) {\n        if (!this.controls || !this.camera || !this.scene) {\n            return;\n        }\n        const camera = this.camera;\n        const scene = this.scene;\n        const { title, data } = props;\n        this.listening = props.listening || {};\n        this.autoPlay = props.autoPlay || this.autoPlay;\n        this.playInterval = props.playInterval || this.playInterval;\n        this.autoRotate = props.autoRotate || this.autoRotate;\n        this.controls.autoRotate = this.autoRotate;\n        if (JSON.stringify(data) !== JSON.stringify(this.treeData) || title !== this.treeTitle) {\n            this.treeData = [...data];\n            this.treeTitle = title;\n            createDataTree({ position: { x: 0, y: 1, z: 0 }, data, title }, group => {\n                scene.add(group);\n                this.treeGroup = group;\n                if (this.autoPlay) {\n                    this.loopDetail(this.playInterval);\n                }\n                const box = new THREE.Box3().setFromObject(group);\n                const { max } = box;\n                if (!isNaN(max.z) && !isNaN(max.y) && !isNaN(max.x)) {\n                    // 相机位置自适应\n                    camera.position.z += max.z;\n                    camera.position.y = max.y + 4;\n                }\n            });\n        }\n    }\n    /**\n     * dispose\n     */\n    dispose() {\n        if (!this.renderer || !this.scene) {\n            return;\n        }\n        this.renderer.dispose();\n        // dispose material\n        const cleanMaterial = (material) => {\n            material.dispose();\n            // dispose textures\n            for (const key of Object.keys(material)) {\n                const value = material[key];\n                if (value && typeof value === 'object' && 'minFilter' in value) {\n                    value.dispose();\n                }\n            }\n        };\n        this.scene.traverse(object => {\n            if (!(object instanceof THREE.Mesh)) {\n                return;\n            }\n            object.geometry.dispose();\n            const materials = object.material;\n            if (!Array.isArray(materials)) {\n                cleanMaterial(materials);\n            }\n            else {\n                // an array of materials\n                materials.forEach(material => cleanMaterial(material));\n            }\n        });\n    }\n    /**\n     * 初始化\n     */\n    init(glDom) {\n        this.dom = glDom;\n        this.initRenderer();\n        this.initCamera();\n        this.initScene();\n        this.initLight();\n        if (this.renderer && this.scene && this.camera) {\n            this.renderer.clear();\n            this.renderer.render(this.scene, this.camera);\n            this.animate();\n            // 绑定事件监听\n            this.dom.onmousemove = (e) => this.handleMousemove(e, glDom);\n        }\n        return {\n            setOption: this.setOption,\n            updateTooltip,\n            dispose: this.dispose,\n        };\n    }\n}\nexport default GlDataTree;\n"],"file":"index.js"}